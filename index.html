<!DOCTYPE html>

<head>
    <script src="https://www.unpkg.com/opensheetmusicdisplay@0.8.6/build/opensheetmusicdisplay.min.js"></script>
    <script src="/js/midipianolistener.js"></script>
    <script src="/js/pianoexercise.js"></script>

    <script>

        var openSheetMusicDisplay; // global object for opensheetmusicdisplay for easy access in the code
        var wrongnotes = 0; // counter of the errors per exercise
        var exercises = [ // array of all exercises that exist
                "singlenote/C4.xml",
                "singlenote/D4.xml",
                "singlenote/E4.xml",
                "singlenote/F4.xml",
                "singlenote/G4.xml",
                "singlenote/A4.xml",
                "singlenote/B4.xml",
                "singlenote/C5.xml",
                "singlenote/D5.xml",
                "singlenote/E5.xml",
                "singlenote/F5.xml",
                "singlenote/G5.xml",
                "singlenote/A5.xml",
                "singlenote/B5.xml",
                "singlenote/C6.xml",
                // CHORDS
                "chords/C4M.xml",
                // BROKEN CHORDS
                "brokenchords/C4M.xml",


        ];
        var fullExercises = [
            "fullsongs/Fur_Elise.musicxml",
        ]

        window.addEventListener('load', onLoad);

        function onLoad() {

            // initialize OSMD
            openSheetMusicDisplay = new opensheetmusicdisplay.OpenSheetMusicDisplay("osmdContainer");
            // https://opensheetmusicdisplay.github.io/classdoc/interfaces/iosmdoptions.html
            openSheetMusicDisplay.setOptions({
                backend: "svg",
                drawTitle: false,
                drawingParameters: "compact", // don't display title, composer etc.
                drawPartNames: false,
            });

            // you can provide a comme-seperated list of exercises in the url hash
            if (window.location.hash.length > 0) {
                exercises = window.location.hash.substr(1).split(',');
            }

            exercises.shuffle();
            nextExercise();
            

        }

        async function nextExercise() {

            exerciseUrl = exercises[Math.floor(Math.random() * exercises.length)];

            console.log("Starting", exerciseUrl);
            var pe = new PianoExercise(exerciseUrl,openSheetMusicDisplay);
            pe.start(onFinished);
            
        }

        function onFinished() {
            console.log("next");
            nextExercise();
        }



        Object.defineProperty(Array.prototype, 'shuffle', {
            value: function() {
                for (let i = this.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [this[i], this[j]] = [this[j], this[i]];
                }
                return this;
            }
        });

    </script>
</head>

<body>

    <div id="osmdContainer"></div>
    
</body>

